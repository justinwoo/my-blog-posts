<!DOCTYPE html><html xmlns:og="http://ogp.me/ns#"><head><meta charset="UTF-8" /><title>Type-level Path Params parsed to Records with PureScript - Qiita</title><meta content="width=device-width,initial-scale=1" name="viewport" /><meta content="Edit: I&#39;ve written a follow-up to this article to write paths from records here: https://qiita.com/kimagure/items/777133d6bbff67e3819d 

Recently, I looked at some examples of how people handle paths and path parameters commonly in &quot;norm..." name="description" /><meta content="#55c500" name="theme-color" /><meta content="summary" name="twitter:card" /><meta content="@Qiita" name="twitter:site" /><meta content="jusrin00" name="twitter:creator" /><meta content="Type-level Path Params parsed to Records with PureScript - Qiita" property="og:title" /><meta content="article" property="og:type" /><meta content="https://qiita.com/kimagure/items/4f5c6054870f631ff768" property="og:url" /><meta content="https://cdn.qiita.com/assets/qiita-fb-2887e7b4aad86fd8c25cea84846f2236.png" property="og:image" /><meta content="*Edit: I&#39;ve written a follow-up to this article to write paths from records here: https://qiita.com/kimagure/items/77..." property="og:description" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><link rel="canonical" href="https://qiita.com/kimagure/items/4f5c6054870f631ff768" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production-4ff10c1e1e2b5fcb353ff9cafdd56c70.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-f9a6afad761ec2306e10db2736187c8b.png" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public-7b2b83455f893b2e91acb9e4a2cad269.min.css" /><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="S8EIzKZHEtuVJEBA+XuPf6aqJ0/FIjw848vOd+CyAzX1L7ORtMEz979VWyw9NIzISDzJz1VDUCVAEIGV/8dbPw==" /><script>
  window.gtmDataLayer = [
    {
      'analytics.dimension5': 'false',
      'app.env': 'production',
      'app.layoutVersion': 1,
      'app.userId': null
    },
    { 'gtm.start': new Date().getTime(), event: 'gtm.js' }
  ];
</script>
<script src="https://www.googletagmanager.com/gtm.js?id=GTM-TBQWPN&l=gtmDataLayer" async></script>
</head><body class="without-js" id=""><noscript><iframe height="0" src="//www.googletagmanager.com/ns.html?id=GTM-TBQWPN" style="display:none;visibility:hidden" width="0"></iframe></noscript><script>
  document.body.className = document.body.className.replace('without-js', '') + ' with-js';
  window.Qiita = {"asset_host":"cdn.qiita.com","TLD":"com","controller_path":"public/items","controller_action":"public/items#show","controller":"items","action":"show","action_path":"public/items#show","env":"production","flash":{},"is_team_page":false,"request_parameters":{"controller":"public/items","action":"show","user_id":"kimagure","type":"items","id":"4f5c6054870f631ff768"},"root_domain":"qiita.com","variant":null,"config":{"mixpanel":{"per_team":"c0a2116368b33b44b5029ebd2cc9b094","public":"17d24b448ca579c365d2d1057f3a1791","team":"b7c0342acba2dbc8742484d98788efb3"},"default_locale":"en","locale":"en"},"team":null,"user":null,"GIT_BRANCH":null,"DEBUG":false};

</script>
<div class="st-HeaderContainer"><script type="application/json" class="js-react-on-rails-component" data-component-name="GlobalHeaderContainer" data-dom-id="GlobalHeaderContainer-react-component-799ef2d7-2996-4ede-a95f-3fd4942414ce">{"user":null,"realms":[{"human_name":"Qiita","is_current_realm":true,"is_qiita":true,"is_qiita_team":false,"logged_in_user":null,"team_id":null,"url":"https://qiita.com/"}],"teamFindUrl":"https://teams-center.qiita.com/find_team","unreadNotificationsCount":null,"locale":"en","is_fluid":false}</script>
    <div id="GlobalHeaderContainer-react-component-799ef2d7-2996-4ede-a95f-3fd4942414ce"></div>
    
</div><div id="main"><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', '', 'auto', { name: 'userTracker' });
ga('userTracker.send', 'pageview');</script><script async="" src="https://www.google-analytics.com/analytics.js"></script><script type="application/ld+json">{  "@context": "http://schema.org",  "@type": "BreadcrumbList",  "itemListElement": [    {      "@type": "ListItem",      "position": 1,      "item": {        "@id": "/",        "name": "Qiita"      }    },    {      "@type": "ListItem",      "position": 2,      "item": {        "@id": "/tags/purescript",        "name": "purescript"      }    }  ]}</script><article class="p-items" itemscope="itemscope" itemtype="http://schema.org/Article"><div class="p-items_wrapper"><div class="p-items_container"><div class="p-items_stickyMenu it-Actions" data-mount-target="articleStickyMenu"></div><div class="p-items_main"><div class="p-items_article" data-article-props="{&quot;author&quot;:{&quot;name&quot;:&quot;Justin W&quot;,&quot;urlName&quot;:&quot;kimagure&quot;,&quot;profileImageUrl&quot;:&quot;https://qiita-image-store.s3.amazonaws.com/0/42481/profile-images/1512389956&quot;,&quot;description&quot;:&quot;Writing about PureScript and Haskell, in English. I can read some Japanese.&quot;,&quot;showUrl&quot;:&quot;https://qiita.com/kimagure&quot;,&quot;followUrl&quot;:&quot;https://qiita.com/kimagure/follow&quot;,&quot;unfollowUrl&quot;:&quot;https://qiita.com/kimagure/unfollow&quot;},&quot;createdAtInUnixtime&quot;:1515852570,&quot;isBanned&quot;:false,&quot;isLiked&quot;:false,&quot;isPublic&quot;:true,&quot;isSecret&quot;:false,&quot;isStocked&quot;:false,&quot;likesCount&quot;:2,&quot;showUrl&quot;:&quot;https://qiita.com/kimagure/items/4f5c6054870f631ff768&quot;,&quot;tags&quot;:[{&quot;isFollowed&quot;:false,&quot;largeIconUrl&quot;:&quot;https://s3-ap-northeast-1.amazonaws.com/qiita-tag-image/aba4237de1ecaa284b21c8e42131658769ae1399/large.jpg?1417615690&quot;,&quot;mediumIconUrl&quot;:&quot;https://s3-ap-northeast-1.amazonaws.com/qiita-tag-image/336916c820dbea8fa57b306ef0e19e78fb15bf4e/medium.jpg?1417615690&quot;,&quot;name&quot;:&quot;purescript&quot;,&quot;showUrl&quot;:&quot;https://qiita.com/tags/purescript&quot;,&quot;thumbIconUrl&quot;:&quot;https://s3-ap-northeast-1.amazonaws.com/qiita-tag-image/57a67566b87fd5d64c996adca3577c52818d156e/thumb.jpg?1417615690&quot;,&quot;urlName&quot;:&quot;purescript&quot;}],&quot;title&quot;:&quot;Type-level Path Params parsed to Records with PureScript&quot;,&quot;uuid&quot;:&quot;4f5c6054870f631ff768&quot;,&quot;body&quot;:&quot;\u003cp\u003e\u003cem\u003eEdit: I&#39;ve written a follow-up to this article to write paths from records here: \u003ca href=\&quot;https://qiita.com/kimagure/items/777133d6bbff67e3819d\&quot; class=\&quot;autolink\&quot; id=\&quot;reference-3ef9c6c950042128f22d\&quot;\u003ehttps://qiita.com/kimagure/items/777133d6bbff67e3819d\u003c/a\u003e\u003c/em\u003e \u003c/p\u003e\n\n\u003cp\u003eRecently, I looked at some examples of how people handle paths and path parameters commonly in \&quot;normal\&quot; programming languages. Many of these approaches involved matching on items in an array produced by a glorified string split on \u003ccode\u003e/\u003c/code\u003e, by both guarding on string value matches and by binding segments into variables (of type string) for use. While these seemed okay enough given the various constraints (or lack thereof, ha) of these examples and the languages they were written for, I didn&#39;t want much to do with it. I wanted more static guarantees about how this would work:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eEven if I match with string values, how do I use this information for other contexts? e.g. using this type information for both client/server code\u003c/li\u003e\n\u003cli\u003eIf I bind the parameters to variables and I want this parameter parsed to integer, then do I end up paying a parsing boilerplate penalty on usage sites everywhere?\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eSo in my own experiment in PureScript, instead of matching on a pattern match on an array, I decided to allow myself to use Symbols (type-level strings) to match literal segments and a phantom/proxy type Param to match the parameter segments, parse them to the type that was needed, and build a Record of these parameters using a Symbol label associated to each Param. Static guarantees bonanza!\u003c/p\u003e\n\n\u003cp\u003e\u003cem\u003eSpeaking of which, I hope you&#39;ll check out \u003ca href=\&quot;http://www.cs.cmu.edu/%7Epopl-interviews/peytonjones.html\&quot; rel=\&quot;nofollow noopener\&quot; target=\&quot;_blank\&quot;\u003ethis interview with Simon Peyton-Jones\u003c/a\u003e and the segment about what was surprising about putting Haskell out to the public:\u003c/em\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cem\u003e\&quot;I think it&#39;s because people in companies are writing software that they want to still be able to maintain and modify in five years time. As you scale up, and as your ambition about timescale increases, so maybe you&#39;ll invest more in the static guarantees you get from a type system, and then you push the type system harder.\&quot;\u003c/em\u003e\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\&quot;path-as-a-collection-of-literal-segments-and-params\&quot; class=\&quot;fragment\&quot;\u003e\u003c/span\u003e\u003ca href=\&quot;#path-as-a-collection-of-literal-segments-and-params\&quot;\u003e\u003ci class=\&quot;fa fa-link\&quot;\u003e\u003c/i\u003e\u003c/a\u003ePath as a collection of literal Segments and Params\u003c/h2\u003e\n\n\u003cp\u003eTo model paths, I needed some kind of heterogeneous collection that wasn&#39;t ugly to use in the end. Luckily for me, there already exists such a structure -- Tuples! So I reused the existing Tuple library and provided myself a infix type operator identical to the existing \u003ca href=\&quot;https://pursuit.purescript.org/packages/purescript-tuples/4.1.0/docs/Data.Tuple.Nested\&quot; rel=\&quot;nofollow noopener\&quot; target=\&quot;_blank\&quot;\u003e\u003ccode\u003e/\\\u003c/code\u003e\u003c/a\u003e operator, but as a more familiar symbol:\u003c/p\u003e\n\n\u003cdiv class=\&quot;code-frame\&quot; data-lang=\&quot;hs\&quot;\u003e\u003cdiv class=\&quot;highlight\&quot;\u003e\u003cpre\u003e\u003cspan class=\&quot;kr\&quot;\u003einfixr\u003c/span\u003e \u003cspan class=\&quot;mi\&quot;\u003e6\u003c/span\u003e \u003cspan class=\&quot;kr\&quot;\u003etype\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eTuple\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eas\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e/\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eFor the literal Segments I needed a data type that would provide a place for my Symbols, so I reused the existing \u003ca href=\&quot;https://pursuit.purescript.org/packages/purescript-symbols/3.0.0/docs/Data.Symbol#t:SProxy\&quot; rel=\&quot;nofollow noopener\&quot; target=\&quot;_blank\&quot;\u003eString Proxy type\u003c/a\u003e and renamed it to not bog down my screen:\u003c/p\u003e\n\n\u003cdiv class=\&quot;code-frame\&quot; data-lang=\&quot;hs\&quot;\u003e\u003cdiv class=\&quot;highlight\&quot;\u003e\u003cpre\u003e\u003cspan class=\&quot;kr\&quot;\u003etype\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eS\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eSProxy\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eAnd for Params, I didn&#39;t know of any existing type that would contain both my Symbol and my type together, so I made a new phantom type to hold this information:\u003c/p\u003e\n\n\u003cdiv class=\&quot;code-frame\&quot; data-lang=\&quot;hs\&quot;\u003e\u003cdiv class=\&quot;highlight\&quot;\u003e\u003cpre\u003e\u003cspan class=\&quot;kr\&quot;\u003edata\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eParam\u003c/span\u003e \u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003elabel\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e::\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eSymbol\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ety\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eParam\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eAnd that&#39;s about it! Now I could set it up so I would write my type-level paths:\u003c/p\u003e\n\n\u003cdiv class=\&quot;code-frame\&quot; data-lang=\&quot;hs\&quot;\u003e\u003cdiv class=\&quot;highlight\&quot;\u003e\u003cpre\u003e\u003cspan class=\&quot;kr\&quot;\u003etype\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eMyRoute\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eS\u003c/span\u003e \u003cspan class=\&quot;s\&quot;\u003e\&quot;hello\&quot;\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e/\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eS\u003c/span\u003e \u003cspan class=\&quot;s\&quot;\u003e\&quot;world\&quot;\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e/\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eParam\u003c/span\u003e \u003cspan class=\&quot;s\&quot;\u003e\&quot;id\&quot;\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eInt\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e/\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eParam\u003c/span\u003e \u003cspan class=\&quot;s\&quot;\u003e\&quot;name\&quot;\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eString\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\&quot;handling-errors-and-parsing-params\&quot; class=\&quot;fragment\&quot;\u003e\u003c/span\u003e\u003ca href=\&quot;#handling-errors-and-parsing-params\&quot;\u003e\u003ci class=\&quot;fa fa-link\&quot;\u003e\u003c/i\u003e\u003c/a\u003eHandling errors and parsing Params\u003c/h2\u003e\n\n\u003cp\u003eAs usual, as I want to collect multiple errors from multiple branches, I&#39;m using the \u003ccode\u003eExcept\u003c/code\u003e type with the left side being a \u003ccode\u003eNonEmptyList error\u003c/code\u003e. The reason I use a non-empty list for errors is that I will never have an empty list of errors, and I should get guarantees from my types about that.\u003c/p\u003e\n\n\u003cp\u003eUsing this, I wrote a data type for my errors and the code to parse a given parameter:\u003c/p\u003e\n\n\u003cdiv class=\&quot;code-frame\&quot; data-lang=\&quot;hs\&quot;\u003e\u003cdiv class=\&quot;highlight\&quot;\u003e\u003cpre\u003e\u003cspan class=\&quot;kr\&quot;\u003edata\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eBadTime\u003c/span\u003e\n  \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eSymbolMatchError\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eString\u003c/span\u003e\n  \u003cspan class=\&quot;o\&quot;\u003e|\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eParamParseError\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eString\u003c/span\u003e\n\n\u003cspan class=\&quot;kr\&quot;\u003etype\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eBadTimes\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eNonEmptyList\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eBadTime\u003c/span\u003e\n\n\u003cspan class=\&quot;kr\&quot;\u003eclass\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eParseParam\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ea\u003c/span\u003e \u003cspan class=\&quot;kr\&quot;\u003ewhere\u003c/span\u003e\n  \u003cspan class=\&quot;n\&quot;\u003eparseParam\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e::\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eString\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eExcept\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eBadTimes\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ea\u003c/span\u003e\n\n\u003cspan class=\&quot;kr\&quot;\u003einstance\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003estringParseParam\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e::\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eParseParam\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eString\u003c/span\u003e \u003cspan class=\&quot;kr\&quot;\u003ewhere\u003c/span\u003e\n  \u003cspan class=\&quot;n\&quot;\u003eparseParam\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003es\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003epure\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003es\u003c/span\u003e\n\n\u003cspan class=\&quot;kr\&quot;\u003einstance\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eintParseParam\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e::\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eParseParam\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eInt\u003c/span\u003e \u003cspan class=\&quot;kr\&quot;\u003ewhere\u003c/span\u003e\n  \u003cspan class=\&quot;n\&quot;\u003eparseParam\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003es\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e\n    \u003cspan class=\&quot;kr\&quot;\u003ecase\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003efromNumber\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e$\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ereadInt\u003c/span\u003e \u003cspan class=\&quot;mi\&quot;\u003e10\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003es\u003c/span\u003e \u003cspan class=\&quot;kr\&quot;\u003eof\u003c/span\u003e\n      \u003cspan class=\&quot;kt\&quot;\u003eJust\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ea\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003epure\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ea\u003c/span\u003e\n      \u003cspan class=\&quot;kt\&quot;\u003eNothing\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e-\u0026gt;\u003c/span\u003e\n        \u003cspan class=\&quot;n\&quot;\u003ethrowError\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e\u0026lt;\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003epure\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e\u0026lt;\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eParamParseError\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e$\u003c/span\u003e\n          \u003cspan class=\&quot;s\&quot;\u003e\&quot;could not parse \&quot;\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e\u0026lt;\u0026gt;\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003es\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e\u0026lt;\u0026gt;\u003c/span\u003e \u003cspan class=\&quot;s\&quot;\u003e\&quot; into integer\&quot;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\&quot;parsing-the-url-using-our-tuple\&quot; class=\&quot;fragment\&quot;\u003e\u003c/span\u003e\u003ca href=\&quot;#parsing-the-url-using-our-tuple\&quot;\u003e\u003ci class=\&quot;fa fa-link\&quot;\u003e\u003c/i\u003e\u003c/a\u003eParsing the URL using our Tuple\u003c/h2\u003e\n\n\u003cp\u003eWhen parsing my route, I knew that using the type information, I wanted to get out two things from handling each section and the overall URL:\u003c/p\u003e\n\n\u003cul\u003e\n\u003cli\u003eA Record.Builder that would give me a function for building a record with my parsed parameters\u003c/li\u003e\n\u003cli\u003eThe remaining string path after applying each section/the whole URL.\u003c/li\u003e\n\u003c/ul\u003e\n\n\u003cp\u003eThe interesting thing about \u003ca href=\&quot;https://pursuit.purescript.org/packages/purescript-record/0.2.5/docs/Data.Record.Builder#t:Builder\&quot; rel=\&quot;nofollow noopener\&quot; target=\&quot;_blank\&quot;\u003eRecord.Builder\u003c/a\u003e is that they can be used to build up a complete record from a starting point, with no intermediate representation costs. They also actually compose together through their \u003ca href=\&quot;https://pursuit.purescript.org/packages/purescript-prelude/3.1.0/docs/Control.Semigroupoid#t:Semigroupoid\&quot; rel=\&quot;nofollow noopener\&quot; target=\&quot;_blank\&quot;\u003eSemigroupoid\u003c/a\u003e instances, providing composable momrphisms, and provide an identity operation through \u003ca href=\&quot;https://pursuit.purescript.org/packages/purescript-prelude/3.1.0/docs/Control.Category#t:Category\&quot; rel=\&quot;nofollow noopener\&quot; target=\&quot;_blank\&quot;\u003eCategory\u003c/a\u003e. While many claim many operations of their programs are \&quot;composable\&quot;, in this case, Builders are legitimately composable.\u003c/p\u003e\n\n\u003cp\u003eAnd so I can define my type class for the Parse URL Implementation for a given type and the from-to row types, with a functional dependency that simply uses the type to look up instances:\u003c/p\u003e\n\n\u003cdiv class=\&quot;code-frame\&quot; data-lang=\&quot;hs\&quot;\u003e\u003cdiv class=\&quot;highlight\&quot;\u003e\u003cpre\u003e\u003cspan class=\&quot;kr\&quot;\u003eclass\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eParseURLImpl\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003exs\u003c/span\u003e \u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003efrom\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e::\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e#\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eType\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e \u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003eto\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e::\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e#\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eType\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e\n  \u003cspan class=\&quot;o\&quot;\u003e|\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003exs\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003efrom\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eto\u003c/span\u003e \u003cspan class=\&quot;kr\&quot;\u003ewhere\u003c/span\u003e\n  \u003cspan class=\&quot;n\&quot;\u003eparseURLImpl\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e::\u003c/span\u003e\n       \u003cspan class=\&quot;kt\&quot;\u003eProxy\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003exs\u003c/span\u003e\n    \u003cspan class=\&quot;o\&quot;\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eString\u003c/span\u003e\n    \u003cspan class=\&quot;o\&quot;\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eExcept\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eBadTimes\u003c/span\u003e\n         \u003cspan class=\&quot;p\&quot;\u003e{\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ebuilder\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e::\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eBuilder\u003c/span\u003e \u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;kt\&quot;\u003eRecord\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003efrom\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e \u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;kt\&quot;\u003eRecord\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eto\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e\n         \u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eremaining\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e::\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eString\u003c/span\u003e\n         \u003cspan class=\&quot;p\&quot;\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eThen writing the instances doesn&#39;t actually take too much. For the Tuple case, I run the left side, use the remaining to run the right, and then compose the builders together and reutrn the right:\u003c/p\u003e\n\n\u003cdiv class=\&quot;code-frame\&quot; data-lang=\&quot;hs\&quot;\u003e\u003cdiv class=\&quot;highlight\&quot;\u003e\u003cpre\u003e\u003cspan class=\&quot;kr\&quot;\u003einstance\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003etupleParseURL\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e::\u003c/span\u003e\n  \u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eParseURLImpl\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eleft\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003efrom&#39;\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eto\u003c/span\u003e\n  \u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eParseURLImpl\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eright\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003efrom\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003efrom&#39;\u003c/span\u003e\n  \u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eParseURLImpl\u003c/span\u003e \u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003eleft\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e/\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eright\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003efrom\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eto\u003c/span\u003e \u003cspan class=\&quot;kr\&quot;\u003ewhere\u003c/span\u003e\n  \u003cspan class=\&quot;n\&quot;\u003eparseURLImpl\u003c/span\u003e \u003cspan class=\&quot;kr\&quot;\u003e_\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003es\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;kr\&quot;\u003edo\u003c/span\u003e\n    \u003cspan class=\&quot;n\&quot;\u003eleft\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e\u0026lt;-\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eparseURLImpl\u003c/span\u003e \u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;kt\&quot;\u003eProxy\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e::\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eProxy\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eleft\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003es\u003c/span\u003e\n    \u003cspan class=\&quot;n\&quot;\u003eright\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e\u0026lt;-\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eparseURLImpl\u003c/span\u003e \u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;kt\&quot;\u003eProxy\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e::\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eProxy\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eright\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eleft\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003eremaining\u003c/span\u003e\n    \u003cspan class=\&quot;n\&quot;\u003epure\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e$\u003c/span\u003e \u003cspan class=\&quot;p\&quot;\u003e{\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ebuilder\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e:\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eleft\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ebuilder\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e\u0026lt;\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eright\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ebuilder\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eremaining\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e:\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eright\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003eremaining\u003c/span\u003e \u003cspan class=\&quot;p\&quot;\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eFor the literal segments, I strip the prefix of \u003ccode\u003e/\u003c/code\u003e and the Symbol segment reflected to string from the path string and return a builder of \u003ccode\u003eid\u003c/code\u003e, since there are no parameters to be added to the params record.\u003c/p\u003e\n\n\u003cdiv class=\&quot;code-frame\&quot; data-lang=\&quot;hs\&quot;\u003e\u003cdiv class=\&quot;highlight\&quot;\u003e\u003cpre\u003e\u003cspan class=\&quot;kr\&quot;\u003einstance\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003esegmentParseURL\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e::\u003c/span\u003e\n  \u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eIsSymbol\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003esegment\u003c/span\u003e\n  \u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eParseURLImpl\u003c/span\u003e \u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;kt\&quot;\u003eSProxy\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003esegment\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003efrom\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003efrom\u003c/span\u003e \u003cspan class=\&quot;kr\&quot;\u003ewhere\u003c/span\u003e\n  \u003cspan class=\&quot;n\&quot;\u003eparseURLImpl\u003c/span\u003e \u003cspan class=\&quot;kr\&quot;\u003e_\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003es\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e\n    \u003cspan class=\&quot;kr\&quot;\u003ecase\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003estripPrefix\u003c/span\u003e \u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;kt\&quot;\u003ePattern\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e$\u003c/span\u003e \u003cspan class=\&quot;s\&quot;\u003e\&quot;/\&quot;\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e\u0026lt;\u0026gt;\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003esegment\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003es\u003c/span\u003e \u003cspan class=\&quot;kr\&quot;\u003eof\u003c/span\u003e\n      \u003cspan class=\&quot;kt\&quot;\u003eNothing\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e-\u0026gt;\u003c/span\u003e\n        \u003cspan class=\&quot;n\&quot;\u003ethrowError\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e\u0026lt;\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003epure\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e\u0026lt;\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eSymbolMatchError\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e$\u003c/span\u003e\n          \u003cspan class=\&quot;s\&quot;\u003e\&quot;could not strip segment \&quot;\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e\u0026lt;\u0026gt;\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003esegment\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e\u0026lt;\u0026gt;\u003c/span\u003e \u003cspan class=\&quot;s\&quot;\u003e\&quot; from path \&quot;\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e\u0026lt;\u0026gt;\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003es\u003c/span\u003e\n      \u003cspan class=\&quot;kt\&quot;\u003eJust\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eremaining\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e-\u0026gt;\u003c/span\u003e\n        \u003cspan class=\&quot;n\&quot;\u003epure\u003c/span\u003e \u003cspan class=\&quot;p\&quot;\u003e{\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ebuilder\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e:\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eid\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eremaining\u003c/span\u003e \u003cspan class=\&quot;p\&quot;\u003e}\u003c/span\u003e\n    \u003cspan class=\&quot;kr\&quot;\u003ewhere\u003c/span\u003e\n      \u003cspan class=\&quot;n\&quot;\u003esegment\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ereflectSymbol\u003c/span\u003e \u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;kt\&quot;\u003eSProxy\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e::\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eSProxy\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003esegment\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eThen for the params, I split off the head of my path string and used my ParseParam class from earlier. Then I used this to return a builder that would insert this value with the associated label to my record.\u003c/p\u003e\n\n\u003cdiv class=\&quot;code-frame\&quot; data-lang=\&quot;hs\&quot;\u003e\u003cdiv class=\&quot;highlight\&quot;\u003e\u003cpre\u003e\u003cspan class=\&quot;kr\&quot;\u003einstance\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eparamParseURL\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e::\u003c/span\u003e\n  \u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eIsSymbol\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003elabel\u003c/span\u003e\n  \u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eParseParam\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ety\u003c/span\u003e\n  \u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eRowLacks\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003elabel\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003efrom\u003c/span\u003e\n  \u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eRowCons\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003elabel\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ety\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003efrom\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eto\u003c/span\u003e\n  \u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eParseURLImpl\u003c/span\u003e \u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;kt\&quot;\u003eParam\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003elabel\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ety\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003efrom\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eto\u003c/span\u003e \u003cspan class=\&quot;kr\&quot;\u003ewhere\u003c/span\u003e\n  \u003cspan class=\&quot;n\&quot;\u003eparseURLImpl\u003c/span\u003e \u003cspan class=\&quot;kr\&quot;\u003e_\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003es\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;kr\&quot;\u003edo\u003c/span\u003e\n    \u003cspan class=\&quot;n\&quot;\u003esplit&#39;\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e\u0026lt;-\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003emaybe\u003c/span\u003e\n                \u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ethrowError\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e\u0026lt;\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003epure\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e\u0026lt;\u0026lt;\u0026lt;\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eParamParseError\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e$\u003c/span\u003e\n                   \u003cspan class=\&quot;s\&quot;\u003e\&quot;could not handle url param segment \&quot;\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e\u0026lt;\u0026gt;\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003es\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e\n                \u003cspan class=\&quot;n\&quot;\u003epure\u003c/span\u003e\n                \u003cspan class=\&quot;n\&quot;\u003esplit\u003c/span\u003e\n    \u003cspan class=\&quot;n\&quot;\u003evalue\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e\u0026lt;-\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eparseParam\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003esplit&#39;\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ebefore\u003c/span\u003e\n    \u003cspan class=\&quot;n\&quot;\u003epure\u003c/span\u003e \u003cspan class=\&quot;p\&quot;\u003e{\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ebuilder\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e:\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eBuilder\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003einsert\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003elabelP\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003evalue\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eremaining\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e:\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003esplit&#39;\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003eafter\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e}\u003c/span\u003e\n    \u003cspan class=\&quot;kr\&quot;\u003ewhere\u003c/span\u003e\n      \u003cspan class=\&quot;n\&quot;\u003elabelP\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eSProxy\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e::\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eSProxy\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003elabel\u003c/span\u003e\n      \u003cspan class=\&quot;n\&quot;\u003elabel\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ereflectSymbol\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003elabelP\u003c/span\u003e\n      \u003cspan class=\&quot;n\&quot;\u003es&#39;\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003edrop\u003c/span\u003e \u003cspan class=\&quot;mi\&quot;\u003e1\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003es\u003c/span\u003e\n      \u003cspan class=\&quot;n\&quot;\u003esplit\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;kr\&quot;\u003ecase\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eindexOf\u003c/span\u003e \u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;kt\&quot;\u003ePattern\u003c/span\u003e \u003cspan class=\&quot;s\&quot;\u003e\&quot;/\&quot;\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003es&#39;\u003c/span\u003e \u003cspan class=\&quot;kr\&quot;\u003eof\u003c/span\u003e\n        \u003cspan class=\&quot;kt\&quot;\u003eJust\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eidx\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003esplitAt\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eidx\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003es&#39;\u003c/span\u003e\n        \u003cspan class=\&quot;kt\&quot;\u003eNothing\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003epure\u003c/span\u003e \u003cspan class=\&quot;p\&quot;\u003e{\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ebefore\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e:\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003es&#39;\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eafter\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e:\u003c/span\u003e \u003cspan class=\&quot;s\&quot;\u003e\&quot;\&quot;\u003c/span\u003e \u003cspan class=\&quot;p\&quot;\u003e}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eAnd that&#39;s actually everything! Not too much involved when just reusing everyone else&#39;s work :)\u003c/p\u003e\n\n\u003cp\u003eI then just wrap this up in a more convenient top-level function:\u003c/p\u003e\n\n\u003cdiv class=\&quot;code-frame\&quot; data-lang=\&quot;hs\&quot;\u003e\u003cdiv class=\&quot;highlight\&quot;\u003e\u003cpre\u003e\u003cspan class=\&quot;n\&quot;\u003eparseUrl\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e::\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eforall\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eto\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003exs\u003c/span\u003e\n   \u003cspan class=\&quot;o\&quot;\u003e.\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eParseURLImpl\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003exs\u003c/span\u003e \u003cspan class=\&quot;nb\&quot;\u003e()\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eto\u003c/span\u003e\n  \u003cspan class=\&quot;o\&quot;\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eProxy\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003exs\u003c/span\u003e\n  \u003cspan class=\&quot;o\&quot;\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eString\u003c/span\u003e\n  \u003cspan class=\&quot;o\&quot;\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eEither\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eBadTimes\u003c/span\u003e \u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;kt\&quot;\u003eRecord\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eto\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e\n\u003cspan class=\&quot;n\&quot;\u003eparseUrl\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ep\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003es\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003erunExcept\u003c/span\u003e \u003cspan class=\&quot;kr\&quot;\u003edo\u003c/span\u003e\n  \u003cspan class=\&quot;n\&quot;\u003eresult\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e\u0026lt;-\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eparseURLImpl\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ep\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003es\u003c/span\u003e\n  \u003cspan class=\&quot;n\&quot;\u003epure\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e$\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eBuilder\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ebuild\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eresult\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ebuilder\u003c/span\u003e \u003cspan class=\&quot;p\&quot;\u003e{}\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e\u003cem\u003eAnd yes, this doesn&#39;t quite check if the rest of the path hasn&#39;t been used, and doesn&#39;t handle query strings or something, but this is a demo. This could always be improved greatly in the future.\u003c/em\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cem\u003eIn retrospect, if I wanted to make this a more reliable library, I should parse URLs into a list or something. But this is just a demo to inspire people to make their own solutions (or flood my own demo with PRs to improve it).\u003c/em\u003e*\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\&quot;usage\&quot; class=\&quot;fragment\&quot;\u003e\u003c/span\u003e\u003ca href=\&quot;#usage\&quot;\u003e\u003ci class=\&quot;fa fa-link\&quot;\u003e\u003c/i\u003e\u003c/a\u003eUsage\u003c/h2\u003e\n\n\u003cp\u003eThe usage ends up being quite simple:\u003c/p\u003e\n\n\u003cdiv class=\&quot;code-frame\&quot; data-lang=\&quot;hs\&quot;\u003e\u003cdiv class=\&quot;highlight\&quot;\u003e\u003cpre\u003e\u003cspan class=\&quot;kr\&quot;\u003etype\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eMyRoute\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eS\u003c/span\u003e \u003cspan class=\&quot;s\&quot;\u003e\&quot;hello\&quot;\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e/\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eS\u003c/span\u003e \u003cspan class=\&quot;s\&quot;\u003e\&quot;world\&quot;\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e/\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eParam\u003c/span\u003e \u003cspan class=\&quot;s\&quot;\u003e\&quot;id\&quot;\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eInt\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e/\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eParam\u003c/span\u003e \u003cspan class=\&quot;s\&quot;\u003e\&quot;name\&quot;\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eString\u003c/span\u003e\n\n\u003cspan class=\&quot;n\&quot;\u003emyRouteP\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e::\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eProxy\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eMyRoute\u003c/span\u003e\n\u003cspan class=\&quot;n\&quot;\u003emyRouteP\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eProxy\u003c/span\u003e\n\n\u003cspan class=\&quot;n\&quot;\u003etestUrl\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e::\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eString\u003c/span\u003e\n\u003cspan class=\&quot;n\&quot;\u003etestUrl\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;s\&quot;\u003e\&quot;/hello/world/1/joe\&quot;\u003c/span\u003e\n\n\u003cspan class=\&quot;n\&quot;\u003emain\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e::\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eEff\u003c/span\u003e \u003cspan class=\&quot;kr\&quot;\u003e_\u003c/span\u003e \u003cspan class=\&quot;kt\&quot;\u003eUnit\u003c/span\u003e\n\u003cspan class=\&quot;n\&quot;\u003emain\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003erunTest\u003c/span\u003e \u003cspan class=\&quot;kr\&quot;\u003edo\u003c/span\u003e\n  \u003cspan class=\&quot;n\&quot;\u003esuite\u003c/span\u003e \u003cspan class=\&quot;s\&quot;\u003e\&quot;LA Galbi\&quot;\u003c/span\u003e \u003cspan class=\&quot;kr\&quot;\u003edo\u003c/span\u003e\n    \u003cspan class=\&quot;n\&quot;\u003etest\u003c/span\u003e \u003cspan class=\&quot;s\&quot;\u003e\&quot;works properly\&quot;\u003c/span\u003e \u003cspan class=\&quot;kr\&quot;\u003edo\u003c/span\u003e\n      \u003cspan class=\&quot;kr\&quot;\u003ecase\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eparseUrl\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003emyRouteP\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003etestUrl\u003c/span\u003e \u003cspan class=\&quot;kr\&quot;\u003eof\u003c/span\u003e\n        \u003cspan class=\&quot;kt\&quot;\u003eLeft\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ee\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003efailure\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e$\u003c/span\u003e \u003cspan class=\&quot;s\&quot;\u003e\&quot;oops: \&quot;\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e\u0026lt;\u0026gt;\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eshow\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ee\u003c/span\u003e\n        \u003cspan class=\&quot;kt\&quot;\u003eRight\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eresult\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e-\u0026gt;\u003c/span\u003e\n          \u003cspan class=\&quot;n\&quot;\u003eassert\u003c/span\u003e \u003cspan class=\&quot;s\&quot;\u003e\&quot;says hi joe #1\&quot;\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e$\u003c/span\u003e\n            \u003cspan class=\&quot;s\&quot;\u003e\&quot;hi \&quot;\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e\u0026lt;\u0026gt;\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eresult\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ename\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e\u0026lt;\u0026gt;\u003c/span\u003e \u003cspan class=\&quot;s\&quot;\u003e\&quot; #\&quot;\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e\u0026lt;\u0026gt;\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eshow\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eresult\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003eid\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e==\u003c/span\u003e \u003cspan class=\&quot;s\&quot;\u003e\&quot;hi joe #1\&quot;\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eAnd so you&#39;ll see that the result of the success case doesn&#39;t require any annotations or anything as those are already available from the function and its instances, so result is a normal record with the fields \u003ccode\u003e( id :: Int, name :: String )\u003c/code\u003e as expected.\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\&quot;conclusion\&quot; class=\&quot;fragment\&quot;\u003e\u003c/span\u003e\u003ca href=\&quot;#conclusion\&quot;\u003e\u003ci class=\&quot;fa fa-link\&quot;\u003e\u003c/i\u003e\u003c/a\u003eConclusion\u003c/h2\u003e\n\n\u003cp\u003eHopefully this has shown you that there are very nice ways to do path parameter parsing with PureScript (and Haskell) that aren&#39;t too much work to implement, for which you can then extend with your own code for building requests, doing client code gneeration, etc. And most importantly, instead of writing a bunch of value-level code, we can write just our types first and get all the generic value-level operations derived for us.\u003c/p\u003e\n\n\u003cp\u003eAnd yes, in many ways this is just a simple/stupid way to do what \u003ca href=\&quot;https://github.com/owickstrom/purescript-trout\&quot; rel=\&quot;nofollow noopener\&quot; target=\&quot;_blank\&quot;\u003ePureScript-Trout\u003c/a\u003e, \u003ca href=\&quot;http://haskell-servant.readthedocs.io/en/stable/tutorial/ApiType.html\&quot; rel=\&quot;nofollow noopener\&quot; target=\&quot;_blank\&quot;\u003eServant\u003c/a\u003e, and \u003ca href=\&quot;https://www.yesodweb.com/book\&quot; rel=\&quot;nofollow noopener\&quot; target=\&quot;_blank\&quot;\u003eYesod\u003c/a\u003e do, but for various reasons, you might want different/simpler guarantees than what those will provide you.\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\&quot;links\&quot; class=\&quot;fragment\&quot;\u003e\u003c/span\u003e\u003ca href=\&quot;#links\&quot;\u003e\u003ci class=\&quot;fa fa-link\&quot;\u003e\u003c/i\u003e\u003c/a\u003eLinks\u003c/h2\u003e\n\n\u003cul\u003e\n\u003cli\u003eThis demo \u003ca href=\&quot;https://github.com/justinwoo/purescript-la-galbi\&quot; class=\&quot;autolink\&quot; rel=\&quot;nofollow noopener\&quot; target=\&quot;_blank\&quot;\u003ehttps://github.com/justinwoo/purescript-la-galbi\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n&quot;,&quot;isDeprecated&quot;:false,&quot;isDestroyable&quot;:false,&quot;isEditRequestSendable&quot;:false,&quot;isLikable&quot;:true,&quot;isStockable&quot;:true,&quot;isUpdatable&quot;:false,&quot;isUpdated&quot;:true,&quot;likeUrl&quot;:&quot;https://qiita.com/api/internal/items/4f5c6054870f631ff768/likes&quot;,&quot;stockUrl&quot;:&quot;https://qiita.com/kimagure/items/4f5c6054870f631ff768/stock&quot;,&quot;toc&quot;:&quot;\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#path-as-a-collection-of-literal-segments-and-params\&quot;\u003ePath as a collection of literal Segments and Params\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#handling-errors-and-parsing-params\&quot;\u003eHandling errors and parsing Params\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#parsing-the-url-using-our-tuple\&quot;\u003eParsing the URL using our Tuple\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#usage\&quot;\u003eUsage\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#conclusion\&quot;\u003eConclusion\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#links\&quot;\u003eLinks\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n&quot;,&quot;totalPv&quot;:541,&quot;unstockUrl&quot;:&quot;https://qiita.com/kimagure/items/4f5c6054870f631ff768/unstock&quot;,&quot;updatedAtInUnixtime&quot;:1515939081}" data-following-likers-props="[]"><div class="it-Header"><div class="u-flex-center-between mb-3"><div class="it-Header_info"><div class="it-Header_author"><a href="/kimagure"><img class="it-Header_authorImage" src="https://qiita-image-store.s3.amazonaws.com/0/42481/profile-images/1512389956" alt="1512389956" /></a> <a class="it-Header_authorName" href="/kimagure">@kimagure</a> </div><div class="it-Header_time"><meta content="2018-01-13T23:09:30+09:00" itemprop="datePublished" /><span data-toggle="tooltip" title="posted at 2018-01-13">Edited at <time datetime="2018-01-14T23:11:21+09:00" itemprop="dateModified">2018-01-14</time></span></div><div class="it-Header_meta"><div class="it-Header_manipulate"><div class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#"><span class="fa fa-ellipsis-h fa-lg"></span></a><ul class="dropdown-menu dropdown-menu-right"><li class="dropdown__item"><a href="/kimagure/items/4f5c6054870f631ff768/revisions"><span class="fa fa-fw fa-history"></span> Revisions</a></li><li class="dropdown__item"><a href="/kimagure/items/4f5c6054870f631ff768/patches"><span class="fa fa-fw fa-inbox"></span> Edit Requests</a></li><li class="dropdown__item"><a href="/kimagure/items/4f5c6054870f631ff768/likers"><span class="fa fa-fw fa-thumbs-up"></span> Show all likers of this article</a></li><li class="dropdown__item"><a href="/kimagure/items/4f5c6054870f631ff768.md"><span class="fa fa-fw fa-file-text-o"></span> Show article as Markdown</a></li><li class="divider" role="separator"></li><li class="dropdown__item"><a data-target=".js-report-form" data-toggle="modal" href="#"><span class="fa fa-fw fa-flag"></span> Report article</a></li></ul></div></div></div></div></div><h1 class="it-Header_title" itemprop="headline">Type-level Path Params parsed to Records with PureScript</h1><div class="it-Tags"><a class="it-Tags_item" href="/tags/purescript"><span>purescript</span></a></div></div><div data-mount-target="mobileArticleActions"></div><section class="it-MdContent" itemprop="articleBody"><div id="item-4f5c6054870f631ff768"><p><em>Edit: I've written a follow-up to this article to write paths from records here: <a href="https://qiita.com/kimagure/items/777133d6bbff67e3819d" class="autolink" id="reference-3ef9c6c950042128f22d">https://qiita.com/kimagure/items/777133d6bbff67e3819d</a></em> </p>

<p>Recently, I looked at some examples of how people handle paths and path parameters commonly in "normal" programming languages. Many of these approaches involved matching on items in an array produced by a glorified string split on <code>/</code>, by both guarding on string value matches and by binding segments into variables (of type string) for use. While these seemed okay enough given the various constraints (or lack thereof, ha) of these examples and the languages they were written for, I didn't want much to do with it. I wanted more static guarantees about how this would work:</p>

<ul>
<li>Even if I match with string values, how do I use this information for other contexts? e.g. using this type information for both client/server code</li>
<li>If I bind the parameters to variables and I want this parameter parsed to integer, then do I end up paying a parsing boilerplate penalty on usage sites everywhere?</li>
</ul>

<p>So in my own experiment in PureScript, instead of matching on a pattern match on an array, I decided to allow myself to use Symbols (type-level strings) to match literal segments and a phantom/proxy type Param to match the parameter segments, parse them to the type that was needed, and build a Record of these parameters using a Symbol label associated to each Param. Static guarantees bonanza!</p>

<p><em>Speaking of which, I hope you'll check out <a href="http://www.cs.cmu.edu/%7Epopl-interviews/peytonjones.html" rel="nofollow noopener" target="_blank">this interview with Simon Peyton-Jones</a> and the segment about what was surprising about putting Haskell out to the public:</em></p>

<p><em>"I think it's because people in companies are writing software that they want to still be able to maintain and modify in five years time. As you scale up, and as your ambition about timescale increases, so maybe you'll invest more in the static guarantees you get from a type system, and then you push the type system harder."</em></p>

<h2>
<span id="path-as-a-collection-of-literal-segments-and-params" class="fragment"></span><a href="#path-as-a-collection-of-literal-segments-and-params"><i class="fa fa-link"></i></a>Path as a collection of literal Segments and Params</h2>

<p>To model paths, I needed some kind of heterogeneous collection that wasn't ugly to use in the end. Luckily for me, there already exists such a structure -- Tuples! So I reused the existing Tuple library and provided myself a infix type operator identical to the existing <a href="https://pursuit.purescript.org/packages/purescript-tuples/4.1.0/docs/Data.Tuple.Nested" rel="nofollow noopener" target="_blank"><code>/\</code></a> operator, but as a more familiar symbol:</p>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre><span class="kr">infixr</span> <span class="mi">6</span> <span class="kr">type</span> <span class="kt">Tuple</span> <span class="n">as</span> <span class="o">/</span>
</pre></div></div>

<p>For the literal Segments I needed a data type that would provide a place for my Symbols, so I reused the existing <a href="https://pursuit.purescript.org/packages/purescript-symbols/3.0.0/docs/Data.Symbol#t:SProxy" rel="nofollow noopener" target="_blank">String Proxy type</a> and renamed it to not bog down my screen:</p>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre><span class="kr">type</span> <span class="kt">S</span> <span class="o">=</span> <span class="kt">SProxy</span>
</pre></div></div>

<p>And for Params, I didn't know of any existing type that would contain both my Symbol and my type together, so I made a new phantom type to hold this information:</p>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre><span class="kr">data</span> <span class="kt">Param</span> <span class="p">(</span><span class="n">label</span> <span class="o">::</span> <span class="kt">Symbol</span><span class="p">)</span> <span class="n">ty</span> <span class="o">=</span> <span class="kt">Param</span>
</pre></div></div>

<p>And that's about it! Now I could set it up so I would write my type-level paths:</p>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre><span class="kr">type</span> <span class="kt">MyRoute</span> <span class="o">=</span> <span class="kt">S</span> <span class="s">"hello"</span> <span class="o">/</span> <span class="kt">S</span> <span class="s">"world"</span> <span class="o">/</span> <span class="kt">Param</span> <span class="s">"id"</span> <span class="kt">Int</span> <span class="o">/</span> <span class="kt">Param</span> <span class="s">"name"</span> <span class="kt">String</span>
</pre></div></div>

<h2>
<span id="handling-errors-and-parsing-params" class="fragment"></span><a href="#handling-errors-and-parsing-params"><i class="fa fa-link"></i></a>Handling errors and parsing Params</h2>

<p>As usual, as I want to collect multiple errors from multiple branches, I'm using the <code>Except</code> type with the left side being a <code>NonEmptyList error</code>. The reason I use a non-empty list for errors is that I will never have an empty list of errors, and I should get guarantees from my types about that.</p>

<p>Using this, I wrote a data type for my errors and the code to parse a given parameter:</p>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre><span class="kr">data</span> <span class="kt">BadTime</span>
  <span class="o">=</span> <span class="kt">SymbolMatchError</span> <span class="kt">String</span>
  <span class="o">|</span> <span class="kt">ParamParseError</span> <span class="kt">String</span>

<span class="kr">type</span> <span class="kt">BadTimes</span> <span class="o">=</span> <span class="kt">NonEmptyList</span> <span class="kt">BadTime</span>

<span class="kr">class</span> <span class="kt">ParseParam</span> <span class="n">a</span> <span class="kr">where</span>
  <span class="n">parseParam</span> <span class="o">::</span> <span class="kt">String</span> <span class="o">-&gt;</span> <span class="kt">Except</span> <span class="kt">BadTimes</span> <span class="n">a</span>

<span class="kr">instance</span> <span class="n">stringParseParam</span> <span class="o">::</span> <span class="kt">ParseParam</span> <span class="kt">String</span> <span class="kr">where</span>
  <span class="n">parseParam</span> <span class="n">s</span> <span class="o">=</span> <span class="n">pure</span> <span class="n">s</span>

<span class="kr">instance</span> <span class="n">intParseParam</span> <span class="o">::</span> <span class="kt">ParseParam</span> <span class="kt">Int</span> <span class="kr">where</span>
  <span class="n">parseParam</span> <span class="n">s</span> <span class="o">=</span>
    <span class="kr">case</span> <span class="n">fromNumber</span> <span class="o">$</span> <span class="n">readInt</span> <span class="mi">10</span> <span class="n">s</span> <span class="kr">of</span>
      <span class="kt">Just</span> <span class="n">a</span> <span class="o">-&gt;</span> <span class="n">pure</span> <span class="n">a</span>
      <span class="kt">Nothing</span> <span class="o">-&gt;</span>
        <span class="n">throwError</span> <span class="o">&lt;&lt;&lt;</span> <span class="n">pure</span> <span class="o">&lt;&lt;&lt;</span> <span class="kt">ParamParseError</span> <span class="o">$</span>
          <span class="s">"could not parse "</span> <span class="o">&lt;&gt;</span> <span class="n">s</span> <span class="o">&lt;&gt;</span> <span class="s">" into integer"</span>
</pre></div></div>

<h2>
<span id="parsing-the-url-using-our-tuple" class="fragment"></span><a href="#parsing-the-url-using-our-tuple"><i class="fa fa-link"></i></a>Parsing the URL using our Tuple</h2>

<p>When parsing my route, I knew that using the type information, I wanted to get out two things from handling each section and the overall URL:</p>

<ul>
<li>A Record.Builder that would give me a function for building a record with my parsed parameters</li>
<li>The remaining string path after applying each section/the whole URL.</li>
</ul>

<p>The interesting thing about <a href="https://pursuit.purescript.org/packages/purescript-record/0.2.5/docs/Data.Record.Builder#t:Builder" rel="nofollow noopener" target="_blank">Record.Builder</a> is that they can be used to build up a complete record from a starting point, with no intermediate representation costs. They also actually compose together through their <a href="https://pursuit.purescript.org/packages/purescript-prelude/3.1.0/docs/Control.Semigroupoid#t:Semigroupoid" rel="nofollow noopener" target="_blank">Semigroupoid</a> instances, providing composable momrphisms, and provide an identity operation through <a href="https://pursuit.purescript.org/packages/purescript-prelude/3.1.0/docs/Control.Category#t:Category" rel="nofollow noopener" target="_blank">Category</a>. While many claim many operations of their programs are "composable", in this case, Builders are legitimately composable.</p>

<p>And so I can define my type class for the Parse URL Implementation for a given type and the from-to row types, with a functional dependency that simply uses the type to look up instances:</p>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre><span class="kr">class</span> <span class="kt">ParseURLImpl</span> <span class="n">xs</span> <span class="p">(</span><span class="n">from</span> <span class="o">::</span> <span class="o">#</span> <span class="kt">Type</span><span class="p">)</span> <span class="p">(</span><span class="n">to</span> <span class="o">::</span> <span class="o">#</span> <span class="kt">Type</span><span class="p">)</span>
  <span class="o">|</span> <span class="n">xs</span> <span class="o">-&gt;</span> <span class="n">from</span> <span class="n">to</span> <span class="kr">where</span>
  <span class="n">parseURLImpl</span> <span class="o">::</span>
       <span class="kt">Proxy</span> <span class="n">xs</span>
    <span class="o">-&gt;</span> <span class="kt">String</span>
    <span class="o">-&gt;</span> <span class="kt">Except</span> <span class="kt">BadTimes</span>
         <span class="p">{</span> <span class="n">builder</span> <span class="o">::</span> <span class="kt">Builder</span> <span class="p">(</span><span class="kt">Record</span> <span class="n">from</span><span class="p">)</span> <span class="p">(</span><span class="kt">Record</span> <span class="n">to</span><span class="p">)</span>
         <span class="p">,</span> <span class="n">remaining</span> <span class="o">::</span> <span class="kt">String</span>
         <span class="p">}</span>
</pre></div></div>

<p>Then writing the instances doesn't actually take too much. For the Tuple case, I run the left side, use the remaining to run the right, and then compose the builders together and reutrn the right:</p>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre><span class="kr">instance</span> <span class="n">tupleParseURL</span> <span class="o">::</span>
  <span class="p">(</span> <span class="kt">ParseURLImpl</span> <span class="n">left</span> <span class="n">from'</span> <span class="n">to</span>
  <span class="p">,</span> <span class="kt">ParseURLImpl</span> <span class="n">right</span> <span class="n">from</span> <span class="n">from'</span>
  <span class="p">)</span> <span class="o">=&gt;</span> <span class="kt">ParseURLImpl</span> <span class="p">(</span><span class="n">left</span> <span class="o">/</span> <span class="n">right</span><span class="p">)</span> <span class="n">from</span> <span class="n">to</span> <span class="kr">where</span>
  <span class="n">parseURLImpl</span> <span class="kr">_</span> <span class="n">s</span> <span class="o">=</span> <span class="kr">do</span>
    <span class="n">left</span> <span class="o">&lt;-</span> <span class="n">parseURLImpl</span> <span class="p">(</span><span class="kt">Proxy</span> <span class="o">::</span> <span class="kt">Proxy</span> <span class="n">left</span><span class="p">)</span> <span class="n">s</span>
    <span class="n">right</span> <span class="o">&lt;-</span> <span class="n">parseURLImpl</span> <span class="p">(</span><span class="kt">Proxy</span> <span class="o">::</span> <span class="kt">Proxy</span> <span class="n">right</span><span class="p">)</span> <span class="n">left</span><span class="o">.</span><span class="n">remaining</span>
    <span class="n">pure</span> <span class="o">$</span> <span class="p">{</span> <span class="n">builder</span><span class="o">:</span> <span class="n">left</span><span class="o">.</span><span class="n">builder</span> <span class="o">&lt;&lt;&lt;</span> <span class="n">right</span><span class="o">.</span><span class="n">builder</span><span class="p">,</span> <span class="n">remaining</span><span class="o">:</span> <span class="n">right</span><span class="o">.</span><span class="n">remaining</span> <span class="p">}</span>
</pre></div></div>

<p>For the literal segments, I strip the prefix of <code>/</code> and the Symbol segment reflected to string from the path string and return a builder of <code>id</code>, since there are no parameters to be added to the params record.</p>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre><span class="kr">instance</span> <span class="n">segmentParseURL</span> <span class="o">::</span>
  <span class="p">(</span> <span class="kt">IsSymbol</span> <span class="n">segment</span>
  <span class="p">)</span> <span class="o">=&gt;</span> <span class="kt">ParseURLImpl</span> <span class="p">(</span><span class="kt">SProxy</span> <span class="n">segment</span><span class="p">)</span> <span class="n">from</span> <span class="n">from</span> <span class="kr">where</span>
  <span class="n">parseURLImpl</span> <span class="kr">_</span> <span class="n">s</span> <span class="o">=</span>
    <span class="kr">case</span> <span class="n">stripPrefix</span> <span class="p">(</span><span class="kt">Pattern</span> <span class="o">$</span> <span class="s">"/"</span> <span class="o">&lt;&gt;</span> <span class="n">segment</span><span class="p">)</span> <span class="n">s</span> <span class="kr">of</span>
      <span class="kt">Nothing</span> <span class="o">-&gt;</span>
        <span class="n">throwError</span> <span class="o">&lt;&lt;&lt;</span> <span class="n">pure</span> <span class="o">&lt;&lt;&lt;</span> <span class="kt">SymbolMatchError</span> <span class="o">$</span>
          <span class="s">"could not strip segment "</span> <span class="o">&lt;&gt;</span> <span class="n">segment</span> <span class="o">&lt;&gt;</span> <span class="s">" from path "</span> <span class="o">&lt;&gt;</span> <span class="n">s</span>
      <span class="kt">Just</span> <span class="n">remaining</span> <span class="o">-&gt;</span>
        <span class="n">pure</span> <span class="p">{</span> <span class="n">builder</span><span class="o">:</span> <span class="n">id</span><span class="p">,</span> <span class="n">remaining</span> <span class="p">}</span>
    <span class="kr">where</span>
      <span class="n">segment</span> <span class="o">=</span> <span class="n">reflectSymbol</span> <span class="p">(</span><span class="kt">SProxy</span> <span class="o">::</span> <span class="kt">SProxy</span> <span class="n">segment</span><span class="p">)</span>
</pre></div></div>

<p>Then for the params, I split off the head of my path string and used my ParseParam class from earlier. Then I used this to return a builder that would insert this value with the associated label to my record.</p>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre><span class="kr">instance</span> <span class="n">paramParseURL</span> <span class="o">::</span>
  <span class="p">(</span> <span class="kt">IsSymbol</span> <span class="n">label</span>
  <span class="p">,</span> <span class="kt">ParseParam</span> <span class="n">ty</span>
  <span class="p">,</span> <span class="kt">RowLacks</span> <span class="n">label</span> <span class="n">from</span>
  <span class="p">,</span> <span class="kt">RowCons</span> <span class="n">label</span> <span class="n">ty</span> <span class="n">from</span> <span class="n">to</span>
  <span class="p">)</span> <span class="o">=&gt;</span> <span class="kt">ParseURLImpl</span> <span class="p">(</span><span class="kt">Param</span> <span class="n">label</span> <span class="n">ty</span><span class="p">)</span> <span class="n">from</span> <span class="n">to</span> <span class="kr">where</span>
  <span class="n">parseURLImpl</span> <span class="kr">_</span> <span class="n">s</span> <span class="o">=</span> <span class="kr">do</span>
    <span class="n">split'</span> <span class="o">&lt;-</span> <span class="n">maybe</span>
                <span class="p">(</span><span class="n">throwError</span> <span class="o">&lt;&lt;&lt;</span> <span class="n">pure</span> <span class="o">&lt;&lt;&lt;</span> <span class="kt">ParamParseError</span> <span class="o">$</span>
                   <span class="s">"could not handle url param segment "</span> <span class="o">&lt;&gt;</span> <span class="n">s</span><span class="p">)</span>
                <span class="n">pure</span>
                <span class="n">split</span>
    <span class="n">value</span> <span class="o">&lt;-</span> <span class="n">parseParam</span> <span class="n">split'</span><span class="o">.</span><span class="n">before</span>
    <span class="n">pure</span> <span class="p">{</span> <span class="n">builder</span><span class="o">:</span> <span class="kt">Builder</span><span class="o">.</span><span class="n">insert</span> <span class="n">labelP</span> <span class="n">value</span><span class="p">,</span> <span class="n">remaining</span><span class="o">:</span> <span class="n">split'</span><span class="o">.</span><span class="n">after</span><span class="p">}</span>
    <span class="kr">where</span>
      <span class="n">labelP</span> <span class="o">=</span> <span class="kt">SProxy</span> <span class="o">::</span> <span class="kt">SProxy</span> <span class="n">label</span>
      <span class="n">label</span> <span class="o">=</span> <span class="n">reflectSymbol</span> <span class="n">labelP</span>
      <span class="n">s'</span> <span class="o">=</span> <span class="n">drop</span> <span class="mi">1</span> <span class="n">s</span>
      <span class="n">split</span> <span class="o">=</span> <span class="kr">case</span> <span class="n">indexOf</span> <span class="p">(</span><span class="kt">Pattern</span> <span class="s">"/"</span><span class="p">)</span> <span class="n">s'</span> <span class="kr">of</span>
        <span class="kt">Just</span> <span class="n">idx</span> <span class="o">-&gt;</span> <span class="n">splitAt</span> <span class="n">idx</span> <span class="n">s'</span>
        <span class="kt">Nothing</span> <span class="o">-&gt;</span> <span class="n">pure</span> <span class="p">{</span> <span class="n">before</span><span class="o">:</span> <span class="n">s'</span><span class="p">,</span> <span class="n">after</span><span class="o">:</span> <span class="s">""</span> <span class="p">}</span>
</pre></div></div>

<p>And that's actually everything! Not too much involved when just reusing everyone else's work :)</p>

<p>I then just wrap this up in a more convenient top-level function:</p>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre><span class="n">parseUrl</span> <span class="o">::</span> <span class="n">forall</span> <span class="n">to</span> <span class="n">xs</span>
   <span class="o">.</span> <span class="kt">ParseURLImpl</span> <span class="n">xs</span> <span class="nb">()</span> <span class="n">to</span>
  <span class="o">=&gt;</span> <span class="kt">Proxy</span> <span class="n">xs</span>
  <span class="o">-&gt;</span> <span class="kt">String</span>
  <span class="o">-&gt;</span> <span class="kt">Either</span> <span class="kt">BadTimes</span> <span class="p">(</span><span class="kt">Record</span> <span class="n">to</span><span class="p">)</span>
<span class="n">parseUrl</span> <span class="n">p</span> <span class="n">s</span> <span class="o">=</span> <span class="n">runExcept</span> <span class="kr">do</span>
  <span class="n">result</span> <span class="o">&lt;-</span> <span class="n">parseURLImpl</span> <span class="n">p</span> <span class="n">s</span>
  <span class="n">pure</span> <span class="o">$</span> <span class="kt">Builder</span><span class="o">.</span><span class="n">build</span> <span class="n">result</span><span class="o">.</span><span class="n">builder</span> <span class="p">{}</span>
</pre></div></div>

<p><em>And yes, this doesn't quite check if the rest of the path hasn't been used, and doesn't handle query strings or something, but this is a demo. This could always be improved greatly in the future.</em></p>

<p><em>In retrospect, if I wanted to make this a more reliable library, I should parse URLs into a list or something. But this is just a demo to inspire people to make their own solutions (or flood my own demo with PRs to improve it).</em>*</p>

<h2>
<span id="usage" class="fragment"></span><a href="#usage"><i class="fa fa-link"></i></a>Usage</h2>

<p>The usage ends up being quite simple:</p>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre><span class="kr">type</span> <span class="kt">MyRoute</span> <span class="o">=</span> <span class="kt">S</span> <span class="s">"hello"</span> <span class="o">/</span> <span class="kt">S</span> <span class="s">"world"</span> <span class="o">/</span> <span class="kt">Param</span> <span class="s">"id"</span> <span class="kt">Int</span> <span class="o">/</span> <span class="kt">Param</span> <span class="s">"name"</span> <span class="kt">String</span>

<span class="n">myRouteP</span> <span class="o">::</span> <span class="kt">Proxy</span> <span class="kt">MyRoute</span>
<span class="n">myRouteP</span> <span class="o">=</span> <span class="kt">Proxy</span>

<span class="n">testUrl</span> <span class="o">::</span> <span class="kt">String</span>
<span class="n">testUrl</span> <span class="o">=</span> <span class="s">"/hello/world/1/joe"</span>

<span class="n">main</span> <span class="o">::</span> <span class="kt">Eff</span> <span class="kr">_</span> <span class="kt">Unit</span>
<span class="n">main</span> <span class="o">=</span> <span class="n">runTest</span> <span class="kr">do</span>
  <span class="n">suite</span> <span class="s">"LA Galbi"</span> <span class="kr">do</span>
    <span class="n">test</span> <span class="s">"works properly"</span> <span class="kr">do</span>
      <span class="kr">case</span> <span class="n">parseUrl</span> <span class="n">myRouteP</span> <span class="n">testUrl</span> <span class="kr">of</span>
        <span class="kt">Left</span> <span class="n">e</span> <span class="o">-&gt;</span> <span class="n">failure</span> <span class="o">$</span> <span class="s">"oops: "</span> <span class="o">&lt;&gt;</span> <span class="n">show</span> <span class="n">e</span>
        <span class="kt">Right</span> <span class="n">result</span> <span class="o">-&gt;</span>
          <span class="n">assert</span> <span class="s">"says hi joe #1"</span> <span class="o">$</span>
            <span class="s">"hi "</span> <span class="o">&lt;&gt;</span> <span class="n">result</span><span class="o">.</span><span class="n">name</span> <span class="o">&lt;&gt;</span> <span class="s">" #"</span> <span class="o">&lt;&gt;</span> <span class="n">show</span> <span class="n">result</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="s">"hi joe #1"</span>
</pre></div></div>

<p>And so you'll see that the result of the success case doesn't require any annotations or anything as those are already available from the function and its instances, so result is a normal record with the fields <code>( id :: Int, name :: String )</code> as expected.</p>

<h2>
<span id="conclusion" class="fragment"></span><a href="#conclusion"><i class="fa fa-link"></i></a>Conclusion</h2>

<p>Hopefully this has shown you that there are very nice ways to do path parameter parsing with PureScript (and Haskell) that aren't too much work to implement, for which you can then extend with your own code for building requests, doing client code gneeration, etc. And most importantly, instead of writing a bunch of value-level code, we can write just our types first and get all the generic value-level operations derived for us.</p>

<p>And yes, in many ways this is just a simple/stupid way to do what <a href="https://github.com/owickstrom/purescript-trout" rel="nofollow noopener" target="_blank">PureScript-Trout</a>, <a href="http://haskell-servant.readthedocs.io/en/stable/tutorial/ApiType.html" rel="nofollow noopener" target="_blank">Servant</a>, and <a href="https://www.yesodweb.com/book" rel="nofollow noopener" target="_blank">Yesod</a> do, but for various reasons, you might want different/simpler guarantees than what those will provide you.</p>

<h2>
<span id="links" class="fragment"></span><a href="#links"><i class="fa fa-link"></i></a>Links</h2>

<ul>
<li>This demo <a href="https://github.com/justinwoo/purescript-la-galbi" class="autolink" rel="nofollow noopener" target="_blank">https://github.com/justinwoo/purescript-la-galbi</a>
</li>
</ul>
</div></section><div class="it-Footer"><div data-mount-target="articleFooterMenu"></div><div class="it-Footer_social mt-1of2"><div class="socialButtons"><div class="socialButtons_twitter"><a class="twitter-share-button" data-text="Type-level Path Params parsed to Records with PureScript on @Qiita" data-url="https://qiita.com/kimagure/items/4f5c6054870f631ff768" href="https://twitter.com/share">Tweet</a></div><div class="socialButtons_hatebu"><a class="hatena-bookmark-button" data-hatena-bookmark-layout="simple-balloon" data-hatena-bookmark-title="Type-level Path Params parsed to Records with PureScript" href="http://b.hatena.ne.jp/entry/https://qiita.com/kimagure/items/4f5c6054870f631ff768" title="Add to Hatena Bookmark"><img alt="Add to Hatena Bookmark" height="20" src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" style="border: none;" width="20" /></a><script async="async" charset="utf-8" src="https://b.st-hatena.com/js/bookmark_button.js" type="text/javascript"></script></div><div class="socialButtons_googlePlus"><div class="g-plusone" data-href="https://qiita.com/kimagure/items/4f5c6054870f631ff768" data-size="medium"></div></div><div class="socialButtons_qiitadon"><a class="mastodonShareButton" href="https://qiitadon.com/share?text=Type-level+Path+Params+parsed+to+Records+with+PureScript+by+kimagure+https%3A%2F%2Fqiita.com%2Fkimagure%2Fitems%2F4f5c6054870f631ff768+%23Qiita+%23purescript" target="_blank" title="Toot on Qiitadon">Toot</a></div><div class="socialButtons_facebook"><div class="fb-like" data-action="like" data-href="https://qiita.com/kimagure/items/4f5c6054870f631ff768" data-layout="button_count" data-share="false" data-show-faces="false"></div></div><div class="socialButtons_pocket"><a class="pocket-btn" data-lang="en" data-pocket-count="horizontal" data-pocket-label="pocket"></a></div></div></div></div><div class="it-AuthorInfo mt-5" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><a href="/kimagure"><img class="it-AuthorInfo_image" itemprop="image" src="https://qiita-image-store.s3.amazonaws.com/0/42481/profile-images/1512389956" alt="1512389956" /></a><div class="it-AuthorInfo_body"><div class="it-AuthorInfo_header"><a class="it-AuthorInfo_name" href="/kimagure">Justin W</a><a class="it-AuthorInfo_urlname" itemprop="name" href="/kimagure">@kimagure</a></div><div class="it-AuthorInfo_description">Writing about PureScript and Haskell, in English. I can read some Japanese.</div><div class="it-AuthorInfo_footer"><script type="application/json" id="js-react-on-rails-context">{}</script>
<script type="application/json" class="js-react-on-rails-component" data-component-name="UserFollowButton" data-dom-id="UserFollowButton-react-component-9938a566-148e-45a4-b10b-6a60bb4ed068">{"initial_followed_by":false,"position":"ArticleAuthorInfo","size":"btn-xs","url_name":"kimagure"}</script>
    <div id="UserFollowButton-react-component-9938a566-148e-45a4-b10b-6a60bb4ed068"></div>
    
</div></div></div></div></div><div class="p-items_options"></div><div class="p-items_toc"><script type="application/json" class="js-react-on-rails-component" data-component-name="Toc" data-dom-id="Toc-react-component-8706c2bf-ccd6-4900-9b12-782e1414619f">{"body":"\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\"#path-as-a-collection-of-literal-segments-and-params\"\u003ePath as a collection of literal Segments and Params\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#handling-errors-and-parsing-params\"\u003eHandling errors and parsing Params\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#parsing-the-url-using-our-tuple\"\u003eParsing the URL using our Tuple\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#usage\"\u003eUsage\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#conclusion\"\u003eConclusion\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\"#links\"\u003eLinks\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n"}</script>
    <div id="Toc-react-component-8706c2bf-ccd6-4900-9b12-782e1414619f"></div>
    
</div></div></div><div class="p-items_container"><div class="p-items_leftDummy"></div><div class="p-items_main"><div class="p-items_aside mt-5"><div id="logly-lift-4279493" /></div><div class="p-items_aside mt-4"><div class="p-items_footnote"><ul class="references js-referencesView mt-5"><li class="references_header"><i class="fa fa-fw fa-link"></i> Linked from these articles</li><li class="references_reference js-reference"><span>Linked from </span><a href="/kimagure/items/777133d6bbff67e3819d#_reference-4b29207decfc22962a32"><img alt="" width="18" height="18" src="https://qiita-image-store.s3.amazonaws.com/0/42481/profile-images/1512389956" />Short: Type-level Path Params to write from Records with PureScript</a><time class="references_datetime js-dateTimeView" datetime="2018-01-14T14:10:26+00:00">2 months ago</time></li><li class="references_reference js-reference"><span>Linked from </span><a href="/kimagure/items/43fd7b02db2950f04a1a#_reference-c4ba3f948eba1028c7fb"><img alt="" width="18" height="18" src="https://qiita-image-store.s3.amazonaws.com/0/42481/profile-images/1512389956" />Short:  Composed Modified JSON parsing for free with Simple-JSON</a><time class="references_datetime js-dateTimeView" datetime="2018-01-27T11:57:21+00:00">about 2 months ago</time></li></ul></div></div><div class="p-items_aside mt-5"><div class="itemsShowComment_wrapper" id="comments"><script type="application/json" class="js-react-on-rails-component" data-component-name="PublicCommentListContainer" data-dom-id="PublicCommentListContainer-react-component-57f73c8f-3554-4dc8-b8ae-1a9e82199774">{"currentUser":null,"initialComments":[],"monthly_public_image_uploadable_size_limit":null,"total_uploaded_public_image_size_in_current_month":null,"item":{"id":599616,"uuid":"4f5c6054870f631ff768","suspended":false,"secret":false},"owner":{"url_name":"kimagure"},"is_team":false,"is_project":false,"logged_in":false,"polling":false,"mention_candidates":[{"id":42481,"url_name":"kimagure","profile_image_url":"https://qiita-image-store.s3.amazonaws.com/0/42481/profile-images/1512389956"}]}</script>
    <div id="PublicCommentListContainer-react-component-57f73c8f-3554-4dc8-b8ae-1a9e82199774"></div>
    
<div class="itemsShowCommentSignupOrLogin"><div class="itemsShowCommentSignupOrLogin_title">Sign up for free and join this conversation.</div><a class="btn btn-primary" href="/signup?redirect_to=%2Fkimagure%2Fitems%2F4f5c6054870f631ff768%23comments">Sign Up</a><div class="itemsShowCommentSignupOrLogin_sub">If you already have a Qiita account <a href="/login?redirect_to=%2Fkimagure%2Fitems%2F4f5c6054870f631ff768%23comments">log in.</a></div></div></div></div></div><div class="p-items_rightDummy"></div></div></article><div class="TagList__label" style="display:none"><span></span><span>purescript</span></div><div class="js-report-form modal fade reportForm"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button name="button" type="submit" class="close" data-dismiss="modal">&times;</button><h4 class="modal-title">Report article</h4></div><div class="modal-body"><form class="new_public_issue_report" id="new_public_issue_report" action="/api/internal/issue_reports" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="authenticity_token" value="DJB0mHUJ6GVuQpmskoSrgDhafC5JtJALnMOGJ8gLGCSyfs/FZ4/JSUQzgsBWy6g31sySrtnV/BI/GMnF135ALg==" /><input type="hidden" value="PublicDomainArticle" name="public_issue_report[target_type]" id="public_issue_report_target_type" /><input type="hidden" value="599616" name="public_issue_report[target_id]" id="public_issue_report_target_id" /><p>Help us understand the problem. What is going on with this item?</p><br /><div class="form-group"><ul class="list-unstyled"><li><label><input required="required" type="radio" value="spam" name="public_issue_report[reason]" id="public_issue_report_reason_spam" /> It&#39;s spam </label></li><li><label><input required="required" type="radio" value="harassment" name="public_issue_report[reason]" id="public_issue_report_reason_harassment" /> It&#39;s abusive or harmful </label></li><li><label><input required="required" type="radio" value="inappropriate_content" name="public_issue_report[reason]" id="public_issue_report_reason_inappropriate_content" /> It contains inappropriate content </label></li></ul></div><div class="reportForm_submitButtonContainer"><button name="button" type="submit" class="btn btn-primary reportForm_submitButton"><i class="fa fa-send"></i> Submit</button></div></form></div></div></div></div></div><footer class="footer"><div class="footer_inner"><div class="footer_container"><ul class="footer_links-left"><li class="footer_link"><a class="footer_copyright" href="http://increments.co.jp"> 2011-2018 Increments Inc.</a></li><li class="footer_link"><a href="https://qiita.com/terms">Terms</a></li><li class="footer_link"><a href="https://qiita.com/privacy">Privacy</a></li><li class="footer_link"><a href="http://help.qiita.com">Help</a></li><li class="footer_link"><a href="https://increments.zendesk.com/anonymous_requests/new">Contact</a></li></ul><ul class="footer_links-right"><li class="footer_link"><a href="https://qiita.com/about">About</a></li><li class="footer_link"><a href="/users">Users</a></li><li class="footer_link"><a href="/tags">Tags</a></li><li class="footer_link"><a href="/items">Items</a></li><li class="footer_link"><a href="http://blog.qiita.com">Blog</a></li><li class="footer_link"><a href="https://qiita.com/api/v2/docs">API</a></li><li class="footer_link"><a href="https://teams.qiita.com/">Team</a></li><li class="footer_link"><a class="js-public-form-feedback-link" data-target=".js-feedback-form" data-toggle="modal" href=""><i class="fa fa-heart"></i> Feedback <i class="fa fa-caret-down"></i></a></li></ul></div></div></footer><div class="js-feedback-form modal fade feedbackForm"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button name="button" type="submit" class="close" data-dismiss="modal">&times;</button><h4 class="modal-title">Feedback</h4></div><div class="modal-body"><form class="js-feedback-form-form" action="/feedbacks" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="authenticity_token" value="j1ZgYADlavV/JiWvbjijm2G2v+ajodBUvhGo6sFDMn8xuNs9EmNL2VVXPsOqd6AsjyBRZjPAvE0dyucI3jZqdQ==" /><input type="hidden" name="redirect_path" id="redirect_path" value="/kimagure/items/4f5c6054870f631ff768" /><div class="form-group"><textarea name="feedback[message]" id="feedback_message" class="form-control js-feedback-form-text-area" placeholder="Please give us any feedback about Qiita." required="required" rows="5">
</textarea></div><div class="feedbackForm_submitButtonContainer"><button name="button" type="submit" class="btn btn-primary feedbackForm_submitButton"><i class="fa fa-send"></i> Submit</button><p class="feedbackForm_note">We don&#39;t reply to any feedback.<br />If you need help with Qiita, please send a support request from <a href="https://increments.zendesk.com/anonymous_requests/new">here</a>.</p></div><div style="position:fixed;top:-99999px;opacity:0.0001;"><input name="feedback[name]" type="text" /></div></form></div></div></div></div><script>// if (window.mixpanel instanceof Element) {
//   window.mixpanel = [];
// }
// (function(f,b){if(!b.__SV){var a,e,i,g;window.mixpanel=b;b._i=[];b.init=function(a,e,d){function f(b,h){var a=h.split(".");2==a.length&&(b=b[a[0]],h=a[1]);b[h]=function(){b.push([h].concat(Array.prototype.slice.call(arguments,0)))}}var c=b;"undefined"!==typeof d?c=b[d]=[]:d="mixpanel";c.people=c.people||[];c.toString=function(b){var a="mixpanel";"mixpanel"!==d&&(a+="."+d);b||(a+=" (stub)");return a};c.people.toString=function(){return c.toString(1)+".people (stub)"};i="disable track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.set_once people.increment people.append people.track_charge people.clear_charges people.delete_user".split(" ");
// for(g=0;g<i.length;g++)f(c,i[g]);b._i.push([a,e,d])};b.__SV=1.2;a=f.createElement("script");a.type="text/javascript";a.async=!0;a.src="//cdn.mxpnl.com/libs/mixpanel-2.2.min.js";e=f.getElementsByTagName("script")[0];e.parentNode.insertBefore(a,e)}})(document,window.mixpanel||[]);</script><script src="https://cdn.qiita.com/assets/public-0e2574e8ab728cc19b89c3d929c3d35c.min.js"></script></body></html>